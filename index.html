<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BULLSEYE ARCADE SCORER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Chivo+Mono:wght@900&family=Oswald:wght@700&display=swap');
        
        :root { 
            --bull-red: #bb0000; 
            --bull-dark: #0a0a0a;
            --bull-grey: #151515;
            --bull-yellow: #ffff00; 
        }

        body { 
            background-color: var(--bull-dark); 
            font-family: 'Oswald', sans-serif; 
            color: white; 
            text-transform: uppercase; 
            overflow: hidden; 
            height: 100vh;
        }

        .score-font { font-family: 'Chivo Mono', monospace; color: #ffffff; }
        
        /* Mobile Input Auto-Shift */
        .input-area-mobile {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .input-shifted {
            transform: translateY(-130px); /* Moves the input up to avoid the keypad */
        }

        /* Desktop vs Mobile Grid Logic */
        @media (min-width: 768px) {
            .game-grid { grid-template-columns: 1fr; height: 100%; gap: 0.5rem; }
            .player-panel { height: 100%; display: flex; flex-direction: column; justify-content: center; }
        }

        @media (max-width: 767px) {
            .game-grid { grid-template-columns: 1fr 1fr; height: 35vh; gap: 4px; }
            .player-panel { height: 100%; padding: 8px; }
        }

        .panel-main { 
            background-color: var(--bull-grey); 
            border: 2px solid #333;
            position: relative;
        }
        
        .active-player { border: 4px solid var(--bull-red) !important; background-color: #1a1a1a; }

        /* Mobile Keypad */
        .keypad-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #000;
            transform: translateY(100%);
            transition: transform 0.3s ease-out;
            z-index: 100;
            border-top: 3px solid var(--bull-red);
        }
        .keypad-open { transform: translateY(0); }

        .keypad-btn { 
            background-color: #111; border: 1px solid #222; color: white; 
            height: 65px; display: flex; align-items: center; justify-content: center; 
            font-size: 1.5rem; font-family: 'Chivo Mono', monospace; 
        }
        .keypad-btn:active { background-color: var(--bull-red); }

        .flashing { animation: blink 0.8s step-start infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        .checkout-pill { 
            background: #000; color: var(--bull-yellow); border: 1px solid var(--bull-red); 
            padding: 2px 6px; font-size: 0.6rem; font-family: 'Chivo Mono', monospace;
        }
    </style>
</head>
<body x-data="dartsApp()" @keydown.window="handleKeyboard($event.key)" @click="initAudio()">

    <template x-if="winner">
        <div class="fixed inset-0 z-[110] bg-black flex flex-col items-center justify-center border-[10px] border-red-600 p-4">
            <h1 class="text-5xl font-black mb-4 text-white italic text-center" x-text="winner.name + ' Wins!'"></h1>
            <button @click="resetLeg()" class="bg-red-600 text-white px-12 py-4 text-2xl font-black border-4 border-white">NEXT LEG</button>
        </div>
    </template>

    <template x-if="screen === 'setup'">
        <div class="h-full flex flex-col justify-center px-6 max-w-md mx-auto w-full">
            <h1 class="text-6xl italic font-black text-white text-center mb-6">BULLS<span class="text-red-600">EYE</span></h1>
            <div class="bg-zinc-900 p-6 border-b-8 border-red-600 space-y-4">
                <input type="text" x-model="players[0].name" class="w-full p-4 font-black uppercase text-black outline-none focus:ring-4 ring-red-600">
                <input type="text" x-model="players[1].name" class="w-full p-4 font-black uppercase text-black outline-none focus:ring-4 ring-red-600">
                <button @click="startGame" class="w-full bg-red-600 text-white py-4 text-3xl font-black uppercase italic">START</button>
            </div>
        </div>
    </template>

    <template x-if="screen === 'game'">
        <div class="h-full flex flex-col">
            
            <div class="game-grid grid p-2 shrink-0">
                <template x-for="(player, index) in players" :key="index">
                    <div @click="activePlayerIndex = index; if(isMobile()) showKeypad = true"
                         :class="activePlayerIndex === index ? 'active-player' : ''"
                         class="panel-main player-panel rounded flex flex-col items-center justify-center">
                        <div class="absolute top-0 left-0 bg-red-600 px-2 py-0.5 md:px-6 md:py-2">
                            <span class="text-[10px] md:text-3xl font-black text-white" x-text="player.name"></span>
                        </div>
                        <div class="score-font text-5xl md:text-[12rem] font-black leading-tight" x-text="player.score"></div>
                        <div class="h-6 md:h-12 flex items-center">
                            <template x-if="player.score <= 170 && getCheckout(player.score)">
                                <div class="checkout-pill md:text-2xl" x-text="getCheckout(player.score)"></div>
                            </template>
                        </div>
                        <div class="hidden md:grid grid-cols-2 w-full mt-4 border-t border-red-600 pt-4">
                             <div class="text-center"><span class="text-xs text-zinc-500 block">AVG</span><span class="text-4xl text-white font-black" x-text="calcAvg(player, 3)"></span></div>
                             <div class="text-center"><span class="text-xs text-zinc-500 block">LEGS</span><span class="text-4xl text-white font-black" x-text="player.legs"></span></div>
                        </div>
                    </div>
                </template>
            </div>

            <div class="md:hidden flex-grow flex flex-col items-center justify-center input-area-mobile" 
                 :class="showKeypad ? 'input-shifted' : ''">
                <span class="text-xs text-red-600 font-black mb-1 bg-black/80 px-4 py-1 rounded" x-text="players[activePlayerIndex].name"></span>
                <div @click="showKeypad = true" 
                     class="text-7xl font-mono font-black italic tracking-tighter" 
                     :class="currentInput === '' ? 'flashing text-zinc-800' : 'text-white'"
                     x-text="currentInput || '---'"></div>
                <div class="text-[10px] text-zinc-600 mt-2">AVG: <span class="text-zinc-300" x-text="calcAvg(players[activePlayerIndex], 3)"></span> | LEGS: <span class="text-zinc-300" x-text="players[activePlayerIndex].legs"></span></div>
            </div>

            <div class="hidden md:flex flex-col items-center justify-center py-12">
                <div class="text-8xl font-mono font-black italic text-white" :class="currentInput === '' ? 'flashing opacity-20' : ''" x-text="currentInput || '---'"></div>
                <div class="text-zinc-500 mt-4">TYPE SCORE + ENTER</div>
            </div>

            <div class="keypad-container md:hidden" :class="showKeypad ? 'keypad-open' : ''">
                <div class="flex justify-between items-center bg-zinc-900 px-4 py-2">
                    <span class="text-[10px] font-black text-red-500">SCORE ENTRY</span>
                    <button @click="showKeypad = false" class="text-[10px] bg-zinc-800 px-3 py-1 font-black">CLOSE</button>
                </div>
                <div class="grid grid-cols-3 gap-0.5 p-0.5">
                    <template x-for="n in ['1','2','3','4','5','6','7','8','9','DEL','0','ENTER']">
                        <button @click="handleBtn(n)" :class="n === 'ENTER' ? 'bg-red-600 text-white' : 'bg-zinc-900 text-white'" class="keypad-btn font-black" x-text="n"></button>
                    </template>
                </div>
            </div>

            <div class="mt-auto flex justify-between p-2 border-t border-zinc-900 shrink-0">
                <button @click="undo" class="text-[10px] text-zinc-600">UNDO</button>
                <button @click="if(confirm('Quit?')) location.reload()" class="text-[10px] text-zinc-800">RESET</button>
            </div>
        </div>
    </template>

    <script>
        function dartsApp() {
            return {
                screen: 'setup', startScore: 501, winner: null, activePlayerIndex: 0, currentInput: '', history: [], audioCtx: null, showKeypad: false,
                players: [{ name: 'PLAYER 1', score: 501, legs: 0, totalPoints: 0, dartsThrown: 0 }, { name: 'PLAYER 2', score: 501, legs: 0, totalPoints: 0, dartsThrown: 0 }],
                isMobile() { return window.innerWidth < 768; },
                handleBtn(n) {
                    if (n === 'DEL') this.currentInput = this.currentInput.slice(0, -1);
                    else if (n === 'ENTER') this.submitScore();
                    else if (this.currentInput.length < 3) this.currentInput += n;
                },
                getCheckout(s) {
                    if (s > 170 || [169, 168, 166, 165, 163, 162, 159].includes(s)) return null;
                    const table = { 170: "T20 T20 BULL", 160: "T20 T20 D20", 100: "T20 D20", 80: "T20 D10", 40: "D20" };
                    return table[s] || (s <= 40 && s % 2 === 0 ? "D" + (s/2) : "FINISH");
                },
                initAudio() { if (!this.audioCtx) this.audioCtx = new (window.AudioContext || window.webkitAudioContext)(); },
                startGame() { this.initAudio(); this.players.forEach(p => { p.score = this.startScore; p.totalPoints = 0; p.dartsThrown = 0; }); this.screen = 'game'; },
                handleKeyboard(key) { if (this.screen === 'game') { if (!isNaN(key)) this.handleBtn(key); if (key === 'Enter') this.submitScore(); if (key === 'Backspace') this.handleBtn('DEL'); } },
                submitScore() {
                    const val = parseInt(this.currentInput) || 0;
                    if (val > 180) { this.currentInput = ''; return; }
                    const p = this.players[this.activePlayerIndex];
                    this.history.push(JSON.parse(JSON.stringify({ players: this.players, active: this.activePlayerIndex })));
                    if (p.score - val === 0) { p.score = 0; p.legs++; this.winner = JSON.parse(JSON.stringify(p)); }
                    else if (p.score - val >= 2) { p.score -= val; p.totalPoints += val; p.dartsThrown += 3; this.activePlayerIndex = (this.activePlayerIndex + 1) % 2; }
                    else { this.activePlayerIndex = (this.activePlayerIndex + 1) % 2; }
                    this.currentInput = '';
                    if (this.isMobile()) this.showKeypad = false;
                },
                calcAvg(p, t) { return p.dartsThrown === 0 ? '0.0' : ((p.totalPoints / p.dartsThrown) * t).toFixed(1); },
                resetLeg() { this.players.forEach(p => p.score = this.startScore); this.winner = null; this.activePlayerIndex = 0; this.showKeypad = false; },
                undo() { if (this.history.length > 0) { const last = this.history.pop(); this.players = last.players; this.activePlayerIndex = last.active; } }
            }
        }
    </script>
</body>
</html>