<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BULLSEYE ARCADE SCORER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Chivo+Mono:wght@900&family=Oswald:wght@700&display=swap');
        
        :root { 
            --bull-red: #bb0000; 
            --bull-dark: #0a0a0a;
            --bull-grey: #151515;
            --bull-yellow: #ffff00; 
        }

        body { 
            background-color: var(--bull-dark); 
            font-family: 'Oswald', sans-serif; 
            color: white; 
            text-transform: uppercase; 
            overflow: hidden; 
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Centering Logic */
        .player-panel { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; /* Vertical center */
            align-items: center;     /* Horizontal center */
            position: relative; 
            text-align: center;
        }

        @media (min-width: 768px) {
            .game-grid { flex: 1; display: flex; flex-direction: column; gap: 8px; padding: 12px; height: calc(100vh - 48px); }
            .score-font { font-size: 30vh; line-height: 1; font-family: 'Chivo Mono', monospace; }
            .input-display { height: 40px; font-size: 28px; margin-top: 10px; }
        }

        @media (max-width: 767px) {
            .game-grid { display: grid; grid-template-columns: 1fr 1fr; flex: 1; gap: 4px; padding: 4px; }
            .score-font { font-size: 18vw; font-family: 'Chivo Mono', monospace; line-height: 1; }
            .input-display { font-size: 8vw; margin-top: 5px; }
            .keypad-active .game-grid { height: 50vh; flex: none; }
        }

        .panel-main { 
            background-color: transparent; 
            border: 2px solid #222;
            transition: all 0.3s ease;
        }
        
        .active-player { border: 4px solid var(--bull-red) !important; background-color: #0f0f0f; }

        .input-display {
            font-family: 'Chivo Mono', monospace;
            font-weight: 900;
            display: flex;
            justify-content: center;
            width: 100%;
        }

        .keypad-container {
            background: #000;
            z-index: 100;
            border-top: 3px solid var(--bull-red);
            height: 0;
            overflow: hidden;
            transition: height 0.3s ease;
        }
        .keypad-open { height: 50vh; }

        .keypad-btn { 
            background-color: #111; border: 1px solid #222; color: white; 
            height: 100%; display: flex; align-items: center; justify-content: center; 
            font-size: 1.5rem; font-family: 'Chivo Mono', monospace; 
        }

        .flashing { animation: blink 0.8s step-start infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        .checkout-pill { 
            background: #000; color: var(--bull-yellow); border: 1px solid var(--bull-red); 
            padding: 2px 12px; font-size: 0.75rem; font-family: 'Chivo Mono', monospace;
            margin-top: 10px;
        }

        .stats-overlay {
            width: 100%;
            padding: 5px 0;
            display: flex;
            justify-content: space-around;
            position: absolute;
            bottom: 10px;
        }
    </style>
</head>
<body x-data="dartsApp()" @keydown.window="handleKeyboard($event.key)">

    <audio id="introMusic" loop><source src="https://assets.mixkit.co/music/preview/mixkit-arcade-retro-changing-90.mp3" type="audio/mpeg"></audio>
    <audio id="thwack"><source src="https://assets.mixkit.co/sfx/preview/mixkit-arrow-thwack-in-board-2390.mp3" type="audio/mpeg"></audio>

    <template x-if="screen === 'setup'">
        <div class="h-full flex flex-col justify-center px-6 max-w-md mx-auto w-full">
            <h1 class="text-7xl italic font-black text-white text-center mb-6">BULLS<span class="text-red-600">EYE</span></h1>
            <div class="bg-zinc-900 p-6 border-b-8 border-red-600 space-y-6 shadow-2xl">
                <div>
                    <label class="text-[10px] font-black text-zinc-500 block mb-2">GAME MODE</label>
                    <div class="flex gap-2">
                        <template x-for="mode in [301, 501]">
                            <button @click="startScore = mode; playThwack();" 
                                    :class="startScore === mode ? 'bg-red-600 text-white' : 'bg-black text-zinc-600'"
                                    class="flex-1 py-4 text-3xl font-black" x-text="mode"></button>
                        </template>
                    </div>
                </div>
                <div class="space-y-3">
                    <label class="text-[10px] font-black text-zinc-500 block">PLAYER NAMES</label>
                    <input type="text" x-model="players[0].name" @focus="startIntro()" class="w-full p-4 bg-black border border-zinc-700 font-black uppercase text-white outline-none focus:border-red-600">
                    <input type="text" x-model="players[1].name" @focus="startIntro()" class="w-full p-4 bg-black border border-zinc-700 font-black uppercase text-white outline-none focus:border-red-600">
                </div>
                <button @click="startGame" class="w-full bg-red-600 text-white py-5 text-3xl font-black uppercase italic">START MATCH</button>
            </div>
        </div>
    </template>

    <template x-if="screen === 'game'">
        <div class="flex flex-col h-full">
            <div class="game-grid" :class="showKeypad ? 'keypad-active' : ''">
                <template x-for="(player, index) in players" :key="index">
                    <div @click="activePlayerIndex = index; if(isMobile()) showKeypad = true"
                         :class="activePlayerIndex === index ? 'active-player' : ''"
                         class="panel-main player-panel rounded">
                        
                        <div class="absolute top-0 left-0 bg-red-600 px-3 py-1 z-10">
                            <span class="text-[10px] md:text-xl font-black text-white" x-text="player.name"></span>
                        </div>

                        <div class="flex flex-col items-center">
                            <div class="score-font font-black" x-text="player.score"></div>
                            
                            <div class="input-display" 
                                 :class="activePlayerIndex === index ? (currentInput === '' ? 'flashing text-zinc-800' : 'text-red-500') : 'opacity-0'">
                                <span x-text="currentInput || '---'"></span>
                            </div>

                            <template x-if="player.score <= 170 && getCheckout(player.score)">
                                <div class="checkout-pill" x-text="getCheckout(player.score)"></div>
                            </template>
                        </div>

                        <div class="stats-overlay">
                             <div class="text-center">
                                <span class="text-[10px] text-zinc-600 block">AVG</span>
                                <span class="text-xl md:text-3xl text-white font-black" x-text="calcAvg(player, 3)"></span>
                             </div>
                             <div class="text-center">
                                <span class="text-[10px] text-zinc-600 block">LEGS</span>
                                <span class="text-xl md:text-3xl text-white font-black" x-text="player.legs"></span>
                             </div>
                        </div>
                    </div>
                </template>
            </div>

            <div class="keypad-container md:hidden" :class="showKeypad ? 'keypad-open' : ''">
                <div class="flex justify-between items-center bg-zinc-900 px-4 py-1 h-8">
                    <span class="text-[10px] font-black text-red-600" x-text="players[activePlayerIndex].name"></span>
                    <button @click="showKeypad = false" class="text-[10px] text-zinc-400 font-bold uppercase">Close</button>
                </div>
                <div class="grid grid-cols-3 gap-0.5 p-0.5 h-[calc(100%-2rem)]">
                    <template x-for="n in ['1','2','3','4','5','6','7','8','9','DEL','0','ENTER']">
                        <button @click="handleBtn(n)" 
                                :class="n === 'ENTER' ? 'bg-red-600 text-white' : 'bg-zinc-900 text-white'" 
                                class="keypad-btn font-black" x-text="n"></button>
                    </template>
                </div>
            </div>

            <div class="flex justify-between p-3 border-t border-zinc-900 bg-black h-12 shrink-0">
                <button @click="undo" class="text-[10px] font-black text-zinc-600">UNDO</button>
                <button @click="location.reload()" class="text-[10px] font-black text-zinc-800">EXIT</button>
            </div>
        </div>
    </template>

    <script>
        function dartsApp() {
            return {
                screen: 'setup', startScore: 501, activePlayerIndex: 0, currentInput: '', history: [], showKeypad: false,
                players: [{ name: 'PLAYER 1', score: 501, legs: 0, totalPoints: 0, dartsThrown: 0 }, { name: 'PLAYER 2', score: 501, legs: 0, totalPoints: 0, dartsThrown: 0 }],
                isMobile() { return window.innerWidth < 768; },
                startIntro() { document.getElementById('introMusic').play().catch(() => {}); },
                playThwack() { 
                    const t = document.getElementById('thwack');
                    t.currentTime = 0; t.volume = 0.2; t.play(); 
                },
                handleBtn(n) {
                    if (n === 'DEL') this.currentInput = this.currentInput.slice(0, -1);
                    else if (n === 'ENTER') this.submitScore();
                    else if (this.currentInput.length < 3) this.currentInput += n;
                },
                getCheckout(s) {
                    const table = { 170: "T20 T20 BULL", 100: "T20 D20", 40: "D20" };
                    return table[s] || (s <= 40 && s % 2 === 0 ? "D" + (s/2) : (s <= 170 ? "FINISH" : null));
                },
                startGame() { 
                    document.getElementById('introMusic').pause();
                    this.players.forEach(p => p.score = this.startScore); 
                    this.screen = 'game'; 
                },
                handleKeyboard(key) { 
                    if (this.screen === 'game') {
                        if (!isNaN(key)) this.handleBtn(key); 
                        if (key === 'Enter') this.submitScore(); 
                        if (key === 'Backspace') this.handleBtn('DEL'); 
                    }
                },
                submitScore() {
                    this.playThwack();
                    const val = parseInt(this.currentInput) || 0;
                    if (val > 180) { this.currentInput = ''; return; }
                    const p = this.players[this.activePlayerIndex];
                    this.history.push(JSON.parse(JSON.stringify({ players: this.players, active: this.activePlayerIndex })));
                    if (p.score - val >= 2 || p.score - val === 0) { 
                        p.score -= val; p.totalPoints += val; p.dartsThrown += 3;
                        if (p.score === 0) { p.legs++; this.players.forEach(pl => pl.score = this.startScore); }
                    }
                    this.activePlayerIndex = (this.activePlayerIndex + 1) % 2;
                    this.currentInput = '';
                    this.showKeypad = false;
                },
                calcAvg(p, t) { return p.dartsThrown === 0 ? '0.0' : ((p.totalPoints / p.dartsThrown) * t).toFixed(1); },
                undo() { if (this.history.length > 0) { const last = this.history.pop(); this.players = last.players; this.activePlayerIndex = last.active; } }
            }
        }
    </script>
</body>
</html>