<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BULLSEYE | THE GUV'NOR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Chivo+Mono:wght@900&family=Oswald:wght@400;700;900&display=swap');
        :root { --bull-red: #ff0000; --bull-dark: #050505; }
        
        body { background: var(--bull-dark); font-family: 'Oswald', sans-serif; color: white; text-transform: uppercase; margin: 0; height: 100dvh; overflow: hidden; }
        
        /* LANDING PAGE SCROLLABLE */
        .landing-page { height: 100dvh; overflow-y: auto; background: radial-gradient(circle at 15% 25%, rgba(255, 0, 0, 0.2) 0%, transparent 50%), var(--bull-dark); }
        .ticker-wrap { background: var(--bull-red); padding: 8px 0; border-bottom: 4px solid white; overflow: hidden; }
        .ticker { display: inline-block; white-space: nowrap; animation: ticker 30s linear infinite; font-weight: 900; color: black; }
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        /* GAME LAYOUT */
        .game-layout { display: flex; flex-direction: column; height: 100dvh; width: 100%; }
        
        /* PLAYER GRID */
        .player-grid { 
            flex: 1; 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            grid-template-rows: repeat(2, 1fr); 
            gap: 1px; 
            background: #1a1a1a;
            min-height: 0;
        }
        /* Handle 2 players: Top/Bottom split */
        .grid-2-players { grid-template-columns: 1fr !important; }
        
        .player-card { 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            background: var(--bull-dark); position: relative; padding: 10px;
        }
        .active-card { background: #0d0d0d; border: 3px solid var(--bull-red); z-index: 10; }
        
        .score-text { font-family: 'Chivo Mono', monospace; font-weight: 900; line-height: 1; }
        .score-large { font-size: clamp(4rem, 15vh, 20vw); }
        .score-small { font-size: clamp(2.5rem, 10vh, 12vw); }

        /* MOBILE NUMPAD (FIXED AT BOTTOM) */
        .numpad { 
            display: grid; grid-template-columns: repeat(3, 1fr); 
            height: 35dvh; background: #333; gap: 1px; flex-shrink: 0;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .numpad button { 
            background: #000; color: white; font-size: 1.8rem; font-weight: 900; 
            border: none; display: flex; align-items: center; justify-content: center;
        }
        .numpad button:active { background: #222; }
        .btn-enter { background: var(--bull-red) !important; grid-column: span 3; font-style: italic; }
        .btn-action { background: #111 !important; color: #666 !important; font-size: 0.9rem !important; }

        @media (min-width: 1024px) {
            .player-grid { grid-template-columns: repeat(auto-fit, minmax(0, 1fr)) !important; grid-template-rows: 1fr !important; }
            .numpad { display: none; }
            .desktop-btns { position: absolute; bottom: 20px; right: 20px; display: flex; gap: 10px; z-index: 100; }
            .d-btn { background: #111; padding: 10px 20px; border: 1px solid #333; font-weight: 900; color: #666; }
        }
    </style>
</head>
<body x-data="dartsApp()" @keydown.window="handleKey($event.key)">

    <template x-if="modal.show">
        <div class="fixed inset-0 bg-black/95 z-[2000] flex items-center justify-center p-4">
            <div class="border-4 border-red-600 bg-zinc-950 p-6 text-center w-full max-w-lg">
                <h3 class="text-zinc-500 font-black text-xs mb-2" x-text="modal.type"></h3>
                <h2 class="text-5xl font-black italic mb-6" x-text="modal.winner"></h2>
                <div class="space-y-2 mb-6">
                    <template x-for="p in players">
                        <div class="bg-zinc-900 p-3 flex justify-between items-center border border-zinc-800">
                            <span class="font-black" x-text="p.name"></span>
                            <span class="text-red-600 font-black" x-text="calcAvg(p)"></span>
                        </div>
                    </template>
                </div>
                <button @click="nextStep()" class="w-full bg-red-600 py-4 font-black italic text-xl">CONTINUE</button>
            </div>
        </div>
    </template>

    <template x-if="screen === 'landing'">
        <div class="landing-page">
            <div class="ticker-wrap"><div class="ticker">NO MATHS REQUIRED • NINE DARTERS ONLY • THE GUV'NOR OF DARTS APPS • DON'T CHOKE ON THE DOUBLE</div></div>
            <div class="max-w-4xl mx-auto p-6 space-y-12 pt-10">
                <h1 class="text-8xl lg:text-[12rem] font-black italic leading-none tracking-tighter">BULLS<span class="text-red-600">EYE</span></h1>
                <div class="bg-zinc-950 p-6 border-4 border-zinc-800 space-y-6">
                    <div class="flex gap-2">
                        <button @click="startScore = 301" :class="startScore === 301 ? 'bg-red-600' : 'bg-zinc-900'" class="flex-1 py-4 text-2xl font-black italic">301</button>
                        <button @click="startScore = 501" :class="startScore === 501 ? 'bg-red-600' : 'bg-zinc-900'" class="flex-1 py-4 text-2xl font-black italic">501</button>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-zinc-900 p-3 border border-zinc-800">
                            <label class="text-[10px] font-black text-zinc-500">LEGS</label>
                            <select x-model.number="legsToSet" class="w-full bg-transparent font-black text-xl text-red-600 outline-none"><option value="1">1</option><option value="3">3</option><option value="5">5</option></select>
                        </div>
                        <div class="bg-zinc-900 p-3 border border-zinc-800">
                            <label class="text-[10px] font-black text-zinc-500">SETS</label>
                            <select x-model.number="setsToMatch" class="w-full bg-transparent font-black text-xl text-red-600 outline-none"><option value="1">1</option><option value="3">3</option></select>
                        </div>
                    </div>
                    <template x-for="(p, i) in setupPlayers" :key="i">
                        <input type="text" x-model="setupPlayers[i]" class="w-full p-4 bg-black border-2 border-zinc-800 font-black italic uppercase outline-none focus:border-red-600" :placeholder="'PLAYER '+(i+1)">
                    </template>
                    <button @click="start()" class="w-full bg-red-600 py-6 text-3xl font-black italic">START GAME</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 pb-10">
                    <div class="space-y-2">
                        <h3 class="text-3xl font-black italic">THE DICTIONARY</h3>
                        <p class="font-black italic text-zinc-500"><span class="text-red-600">BED & BREAKFAST:</span> SCORING 26.</p>
                        <p class="font-black italic text-zinc-500"><span class="text-red-600">FISH & CHIPS:</span> SCORING 33.</p>
                    </div>
                    <div class="bg-red-600 p-4 text-black font-black italic">WINNER BUYS THE FIRST ROUND. NO EXCUSES.</div>
                </div>
            </div>
        </div>
    </template>

    <template x-if="screen === 'game'">
        <div class="game-layout">
            <div class="player-grid" :class="players.length === 2 ? 'grid-2-players' : ''">
                <template x-for="(p, i) in players" :key="i">
                    <div class="player-card" :class="active === i ? 'active-card' : ''">
                        <div class="text-center">
                            <div class="font-black text-sm italic opacity-60" x-text="p.name"></div>
                            <div class="text-[10px] font-black text-red-600 uppercase" x-text="p.sets+'S | '+p.legs+'L'"></div>
                        </div>
                        <div class="score-text" :class="players.length > 2 ? 'score-small' : 'score-large'" x-text="p.score"></div>
                        
                        <div class="h-8 flex items-center">
                            <template x-if="active === i">
                                <span class="text-xl lg:text-3xl font-black text-red-600 italic" x-text="currentInput || getCheckout(p.score)"></span>
                            </template>
                        </div>
                        
                        <div class="text-[10px] font-black text-zinc-500 uppercase">AVG: <span class="text-white" x-text="calcAvg(p)"></span></div>
                    </div>
                </template>
            </div>

            <div class="numpad lg:hidden">
                <template x-for="n in ['1','2','3','4','5','6','7','8','9']">
                    <button @touchstart.prevent="addNum(n)" x-text="n"></button>
                </template>
                <button @touchstart.prevent="undo()" class="btn-action">UNDO</button>
                <button @touchstart.prevent="addNum('0')">0</button>
                <button @touchstart.prevent="location.reload()" class="btn-action text-red-600">QUIT</button>
                <button @touchstart.prevent="submit()" class="btn-enter">ENTER SCORE</button>
            </div>

            <div class="desktop-btns hidden lg:flex">
                <button @click="undo()" class="d-btn">UNDO</button>
                <button @click="location.reload()" class="d-btn text-red-600">QUIT</button>
            </div>
        </div>
    </template>

    <script>
        function dartsApp() {
            return {
                screen: 'landing', startScore: 501, legsToSet: 3, setsToMatch: 1,
                setupPlayers: ['', ''], players: [], active: 0, currentInput: '', history: [],
                modal: { show: false, winner: '', type: '', isMatchOver: false },
                
                checkouts: {
                    170: "T20 T20 BULL", 167: "T20 T19 BULL", 164: "T20 T18 BULL", 161: "T20 T17 BULL", 160: "T20 T20 D20",
                    158: "T20 T20 D19", 157: "T20 T19 D20", 156: "T20 T20 D18", 155: "T20 T19 D19", 154: "T20 T18 D20",
                    141: "T20 T15 D18", 121: "T20 T15 D8", 100: "T20 D20", 80: "T20 D10", 60: "S20 D20", 50: "S10 D20",
                    40: "D20", 38: "D19", 36: "D18", 32: "D16", 20: "D10", 16: "D8", 8: "D4", 4: "D2", 2: "D1"
                },

                getCheckout(s) { return this.checkouts[s] || (s <= 170 && s > 1 ? "FINISH ON DOUBLE" : ""); },
                start() {
                    const names = this.setupPlayers.filter(n => n.trim() !== '');
                    this.players = (names.length >= 2 ? names : ['MUG 1', 'MUG 2']).map(n => ({
                        name: n.toUpperCase(), score: this.startScore, legs: 0, sets: 0, pts: 0, darts: 0
                    }));
                    this.screen = 'game';
                },
                addNum(n) { if (this.currentInput.length < 3) this.currentInput += n; },
                handleKey(k) {
                    if (this.screen !== 'game') return;
                    if (!isNaN(k)) this.addNum(k);
                    if (k === 'Enter') this.submit();
                    if (k === 'Backspace') this.currentInput = this.currentInput.slice(0, -1);
                },
                submit() {
                    const val = parseInt(this.currentInput);
                    if (isNaN(val) || val > 180) { this.currentInput = ''; return; }
                    const p = this.players[this.active];
                    this.history.push(JSON.stringify({p: JSON.parse(JSON.stringify(this.players)), a: this.active}));
                    
                    if (p.score - val === 0) {
                        p.score = 0; p.pts += val; p.darts += 3; this.win(p);
                    } else if (p.score - val > 1) {
                        p.score -= val; p.pts += val; p.darts += 3; this.active = (this.active + 1) % this.players.length;
                    } else {
                        p.darts += 3; this.active = (this.active + 1) % this.players.length;
                    }
                    this.currentInput = '';
                },
                win(p) {
                    p.legs++;
                    if (p.legs >= this.legsToSet) { p.legs = 0; p.sets++; this.modal.type = "SET WON"; }
                    else { this.modal.type = "LEG WON"; }
                    if (p.sets >= this.setsToMatch) { this.modal.type = "MATCH WON"; this.modal.isMatchOver = true; }
                    this.modal.winner = p.name; this.modal.show = true;
                },
                nextStep() {
                    if (this.modal.isMatchOver) location.reload();
                    this.players.forEach(pl => pl.score = this.startScore);
                    this.modal.show = false;
                },
                calcAvg(p) { return p.darts === 0 ? '0.0' : ((p.pts / p.darts) * 3).toFixed(1); },
                undo() { if (this.history.length > 0) { const s = JSON.parse(this.history.pop()); this.players = s.p; this.active = s.a; } }
            }
        }
    </script>
</body>
</html>