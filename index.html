<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BULLSEYE | THE GUV'NOR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Chivo+Mono:wght@900&family=Oswald:wght@400;700;900&display=swap');
        :root { --bull-red: #ff0000; --bull-dark: #050505; }
        
        body { background: var(--bull-dark); font-family: 'Oswald', sans-serif; color: white; text-transform: uppercase; margin: 0; height: 100dvh; overflow: hidden; }
        
        .landing-page { height: 100dvh; overflow-y: auto; background: radial-gradient(circle at 15% 25%, rgba(255, 0, 0, 0.3) 0%, transparent 50%), linear-gradient(0deg, #000 0%, #0a0a0a 100%); }
        .ticker-wrap { background: var(--bull-red); padding: 12px 0; border-bottom: 4px solid white; overflow: hidden; position: sticky; top: 0; z-index: 100; }
        .ticker { display: inline-block; white-space: nowrap; animation: ticker 25s linear infinite; font-weight: 900; color: black; font-style: italic; font-size: 1.2rem; }
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        /* GAME ENGINE LAYOUT */
        .game-layout { display: flex; flex-direction: column; height: 100dvh; width: 100%; }
        .player-grid { flex: 1; display: grid; grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); gap: 1px; background: #222; min-height: 0; }
        .grid-2-players { grid-template-columns: 1fr !important; }
        
        .player-card { display: flex; flex-direction: column; justify-content: center; align-items: center; background: var(--bull-dark); position: relative; padding: 10px; transition: all 0.2s; }
        .active-card { background: #0a0a0a; box-shadow: inset 0 0 100px rgba(255, 0, 0, 0.15); border: 4px solid var(--bull-red); z-index: 10; }
        
        .score-text { font-family: 'Chivo Mono', monospace; font-weight: 900; line-height: 0.9; letter-spacing: -0.05em; }
        .score-large { font-size: clamp(5rem, 22vh, 25vw); }
        .score-small { font-size: clamp(3rem, 12vh, 15vw); }

        /* THE NUMPAD (MOBILE ONLY) */
        .numpad { display: grid; grid-template-columns: repeat(3, 1fr); height: 38dvh; background: #333; gap: 1px; flex-shrink: 0; padding-bottom: env(safe-area-inset-bottom); }
        .numpad button { background: #000; color: white; font-size: 2.2rem; font-weight: 900; border: none; font-style: italic; }
        .numpad button:active { background: var(--bull-red); color: white; }
        .btn-enter { background: var(--bull-red) !important; grid-column: span 3; font-size: 2.5rem !important; }
        .btn-action { background: #111 !important; color: #555 !important; font-size: 1rem !important; }

        @media (min-width: 1024px) {
            .player-grid { grid-template-columns: repeat(auto-fit, minmax(0, 1fr)) !important; grid-template-rows: 1fr !important; }
            .numpad { display: none; }
            .desktop-btns { position: absolute; bottom: 30px; right: 30px; display: flex; gap: 15px; z-index: 100; }
            .d-btn { background: #111; padding: 15px 30px; border: 2px solid #333; font-weight: 900; color: #444; cursor: pointer; }
            .d-btn:hover { border-color: var(--bull-red); color: white; }
        }
    </style>
</head>
<body x-data="dartsApp()" @keydown.window="handleKey($event.key)">

    <template x-if="modal.show">
        <div class="fixed inset-0 bg-black/98 z-[2000] flex items-center justify-center p-4">
            <div class="border-[8px] border-red-600 bg-black p-8 text-center w-full max-w-xl shadow-[0_0_100px_rgba(255,0,0,0.4)]">
                <h3 class="text-red-600 font-black text-sm mb-2 tracking-[0.5em]" x-text="modal.type"></h3>
                <h2 class="text-7xl lg:text-9xl font-black italic mb-8 leading-none" x-text="modal.winner"></h2>
                <div class="space-y-4 mb-10">
                    <template x-for="p in players">
                        <div class="bg-zinc-900/50 p-5 flex justify-between items-center border-l-4 border-red-600">
                            <span class="font-black text-2xl italic" x-text="p.name"></span>
                            <div class="text-right">
                                <span class="block text-[10px] text-zinc-500 font-black">3-DART AVG</span>
                                <span class="text-white font-black text-4xl" x-text="calcAvg(p)"></span>
                            </div>
                        </div>
                    </template>
                </div>
                <button @click="nextStep()" class="w-full bg-red-600 py-6 font-black italic text-3xl hover:bg-white hover:text-black transition-all transform active:scale-95">NEXT LEG</button>
            </div>
        </div>
    </template>

    <template x-if="screen === 'landing'">
        <div class="landing-page">
            <div class="ticker-wrap"><div class="ticker">DON'T CHOKE ON THE DOUBLE • WINNER BUYS THE ROUND • NO MATHS, JUST DARTS • THE GUV'NOR IS IN THE BUILDING • STAND BACK, PROS AT WORK</div></div>
            <div class="max-w-6xl mx-auto p-6 lg:p-12 space-y-16">
                
                <header class="space-y-4">
                    <h1 class="text-[5rem] lg:text-[14rem] font-black italic leading-[0.8] tracking-tighter">BULLS<span class="text-red-600">EYE.</span></h1>
                    <p class="text-2xl lg:text-5xl font-black italic text-zinc-600">THE ABSOLUTE GUV'NOR OF SCORERS.</p>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                    <div class="bg-zinc-950 p-8 border-[6px] border-zinc-900 space-y-8">
                        <div class="flex gap-4">
                            <button @click="startScore = 301" :class="startScore === 301 ? 'bg-red-600' : 'bg-zinc-900 text-zinc-500'" class="flex-1 py-6 text-4xl font-black italic transition-all">301</button>
                            <button @click="startScore = 501" :class="startScore === 501 ? 'bg-red-600' : 'bg-zinc-900 text-zinc-500'" class="flex-1 py-6 text-4xl font-black italic transition-all">501</button>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-6">
                            <div class="bg-zinc-900 p-4 border-b-4 border-red-600">
                                <label class="text-xs font-black text-zinc-500">LEGS / SET</label>
                                <select x-model.number="legsToSet" class="w-full bg-transparent font-black text-3xl outline-none"><option value="1">1</option><option value="3">3</option><option value="5">5</option></select>
                            </div>
                            <div class="bg-zinc-900 p-4 border-b-4 border-red-600">
                                <label class="text-xs font-black text-zinc-500">SETS / MATCH</label>
                                <select x-model.number="setsToMatch" class="w-full bg-transparent font-black text-3xl outline-none"><option value="1">1</option><option value="3">3</option></select>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <template x-for="(p, i) in setupPlayers" :key="i">
                                <input type="text" x-model="setupPlayers[i]" class="w-full p-6 bg-black border-2 border-zinc-800 font-black text-2xl italic uppercase outline-none focus:border-red-600 focus:bg-zinc-900 transition-all" :placeholder="'LEGEND '+(i+1)">
                            </template>
                        </div>

                        <button @click="start()" class="w-full bg-red-600 py-8 text-4xl lg:text-5xl font-black italic hover:bg-white hover:text-red-600 transition-all shadow-[0_10px_0_0_#990000] active:shadow-none active:translate-y-[10px]">LET'S HAVE IT</button>
                    </div>

                    <div class="space-y-12 py-8">
                        <div class="space-y-2">
                            <h2 class="text-4xl font-black italic text-red-600">WHY THIS APP?</h2>
                            <p class="text-2xl font-black italic">BECAUSE MATHS IS FOR THE PUB QUIZ, NOT THE OCHEY.</p>
                        </div>
                        
                        <div class="grid grid-cols-1 gap-6">
                            <div class="border-l-4 border-zinc-800 pl-6">
                                <h4 class="font-black text-xl italic">THE 170 BRAIN</h4>
                                <p class="text-zinc-500 font-black italic">FULL 3-DART CHECKOUTS. IF IT'S ON, WE SHOW IT. NO GUESSING.</p>
                            </div>
                            <div class="border-l-4 border-zinc-800 pl-6">
                                <h4 class="font-black text-xl italic">LEGENDARY AVERAGES</h4>
                                <p class="text-zinc-500 font-black italic">REAL-TIME STATS. SEE EXACTLY WHO'S BOTTLE HAS GONE.</p>
                            </div>
                            <div class="border-l-4 border-zinc-800 pl-6">
                                <h4 class="font-black text-xl italic">ZERO FLUFF</h4>
                                <p class="text-zinc-500 font-black italic">NO LOGINS. NO ADS. NO NONSENSE. JUST DARTS.</p>
                            </div>
                        </div>

                        <div class="bg-red-600 p-6 -rotate-2">
                            <h3 class="text-3xl font-black italic text-black uppercase">THE RULES OF THE PUB</h3>
                            <ul class="text-black font-black italic list-disc list-inside">
                                <li>LOOSER CHALKS (OR USES THE APP).</li>
                                <li>FIRST TO THE BAR BUYS THE FIRST PINT.</li>
                                <li>NINE DARTER = YOU'RE A GOD.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template x-if="screen === 'game'">
        <div class="game-layout">
            <div class="player-grid" :class="players.length === 2 ? 'grid-2-players' : ''">
                <template x-for="(p, i) in players" :key="i">
                    <div class="player-card" :class="active === i ? 'active-card' : ''">
                        <div class="text-center">
                            <div class="font-black text-xl italic opacity-50" x-text="p.name"></div>
                            <div class="text-xs font-black text-red-600 tracking-widest" x-text="p.sets+'S | '+p.legs+'L'"></div>
                        </div>
                        
                        <div class="score-text" :class="players.length > 2 ? 'score-small' : 'score-large'" x-text="p.score"></div>
                        
                        <div class="h-16 flex items-center text-center px-4">
                            <template x-if="active === i">
                                <span class="text-2xl lg:text-5xl font-black text-red-600 italic tracking-tighter" x-text="currentInput || getCheckout(p.score)"></span>
                            </template>
                        </div>
                        
                        <div class="font-black text-zinc-500 italic">AVG: <span class="text-white" x-text="calcAvg(p)"></span></div>
                    </div>
                </template>
            </div>

            <div class="numpad lg:hidden">
                <template x-for="n in ['1','2','3','4','5','6','7','8','9']">
                    <button @touchstart.prevent="addNum(n)" x-text="n"></button>
                </template>
                <button @touchstart.prevent="undo()" class="btn-action">UNDO</button>
                <button @touchstart.prevent="addNum('0')">0</button>
                <button @touchstart.prevent="location.reload()" class="btn-action text-red-600">QUIT</button>
                <button @touchstart.prevent="submit()" class="btn-enter italic">ENTER</button>
            </div>

            <div class="desktop-btns hidden lg:flex">
                <button @click="undo()" class="d-btn">UNDO</button>
                <button @click="location.reload()" class="d-btn">QUIT</button>
            </div>
        </div>
    </template>

    <script>
        function dartsApp() {
            return {
                screen: 'landing', startScore: 501, legsToSet: 3, setsToMatch: 1,
                setupPlayers: ['', ''], players: [], active: 0, currentInput: '', history: [],
                modal: { show: false, winner: '', type: '', isMatchOver: false },
                
                checkouts: {
                    170: "T20 T20 BULL", 167: "T20 T19 BULL", 164: "T20 T18 BULL", 161: "T20 T17 BULL", 160: "T20 T20 D20",
                    158: "T20 T20 D19", 157: "T20 T19 D20", 156: "T20 T20 D18", 155: "T20 T19 D19", 154: "T20 T18 D20",
                    141: "T20 T15 D18", 121: "T20 T15 D8", 100: "T20 D20", 80: "T20 D10", 60: "S20 D20", 50: "S10 D20",
                    40: "D20", 32: "D16", 16: "D8", 8: "D4", 4: "D2", 2: "D1"
                },

                getCheckout(s) { return this.checkouts[s] || (s <= 170 && s > 1 ? "FINISH ON DOUBLE" : ""); },
                start() {
                    const names = this.setupPlayers.filter(n => n.trim() !== '');
                    this.players = (names.length >= 2 ? names : ['LEGEND 1', 'LEGEND 2']).map(n => ({
                        name: n.toUpperCase(), score: this.startScore, legs: 0, sets: 0, pts: 0, darts: 0
                    }));
                    this.screen = 'game';
                },
                addNum(n) { if (this.currentInput.length < 3) this.currentInput += n; },
                handleKey(k) {
                    if (this.screen !== 'game') return;
                    if (!isNaN(k)) this.addNum(k);
                    if (k === 'Enter') this.submit();
                    if (k === 'Backspace') this.currentInput = this.currentInput.slice(0, -1);
                    if (k === 'Delete') this.undo();
                },
                submit() {
                    const val = parseInt(this.currentInput);
                    if (isNaN(val) || val > 180) { this.currentInput = ''; return; }
                    const p = this.players[this.active];
                    this.history.push(JSON.stringify({p: JSON.parse(JSON.stringify(this.players)), a: this.active}));
                    
                    if (p.score - val === 0) {
                        p.score = 0; p.pts += val; p.darts += 3; this.win(p);
                    } else if (p.score - val > 1) {
                        p.score -= val; p.pts += val; p.darts += 3; this.active = (this.active + 1) % this.players.length;
                    } else {
                        p.darts += 3; this.active = (this.active + 1) % this.players.length;
                    }
                    this.currentInput = '';
                },
                win(p) {
                    p.legs++;
                    if (p.legs >= this.legsToSet) { p.legs = 0; p.sets++; this.modal.type = "SET WON"; }
                    else { this.modal.type = "LEG WON"; }
                    if (p.sets >= this.setsToMatch) { this.modal.type = "MATCH WON"; this.modal.isMatchOver = true; }
                    this.modal.winner = p.name; this.modal.show = true;
                },
                nextStep() {
                    if (this.modal.isMatchOver) location.reload();
                    this.players.forEach(pl => pl.score = this.startScore);
                    this.modal.show = false;
                },
                calcAvg(p) { return p.darts === 0 ? '0.0' : ((p.pts / p.darts) * 3).toFixed(1); },
                undo() { if (this.history.length > 0) { const s = JSON.parse(this.history.pop()); this.players = s.p; this.active = s.a; } }
            }
        }
    </script>
</body>
</html>